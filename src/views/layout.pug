<!DOCTYPE html>
html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        meta(http-equiv="X-UA-Compatible", content="ie=edge")
        link(rel="stylesheet", href="/static/w3.css")
        link(rel="stylesheet", href="/static/style.css")
        script(src="/static/jquery.min.js")
        style.
            body{
                background-color: #eee;
            }
            fieldset{
                background-color: #fff;
            }
        title
            block title
    body
        script.
            var private = true;
        #container
            #header.w3-black.w3-row
                .w3-col.s12.m4.l4
                    .w3-margin
                        a.w3-hover-text-red(href="/" style={'text-decoration':'none'} title="Go to home") Go to homepage
                        .clock
                .w3-col.s8.m6.l6.private
                    .w3-right.w3-margin
                        form(action="/cp", method="get")
                            .w3-row
                                .w3-col.s8.m8.l10
                                    input.w3-input.w3-border(type="text", name="serial", placeholder="Enter CP serial number")
                                .w3-col.s4.m4.l2
                                    button.w3-btn.w3-border Go
                .w3-col.s4.m2.l2.private
                    .w3-right.w3-margin
                        form(action="/logout", method="post")
                            button.w3-button Logout

            #body.w3-container
                block content
            #footer.w3-center
                .clock.w3-padding
                .last-commit-info.w3-margin-bottom
        
        script var lastCommit = null;
        script(src="/last-commit.js")
        script.
            $(function () {
                if (!private) {
                    $('.private').hide();
                }
                setInterval(setClock, 500);

                if (lastCommit) {
                    var now = Date.now() / 1000;
                    var timePassed = Math.round(now - parseInt(lastCommit.authoredOn));
                    var link = 'https://github.com/pSnehanshu/charge-point-simulator/commit/' + lastCommit.hash;
                    var text = '<a target="_blank" href="' + link + '">Latest commit</a> was authored ';
                    text += millisecondsToStr(timePassed * 1000) + ' ago ';
                    text += 'by <a href="mailto:' + lastCommit.author.email + '">' + lastCommit.author.name + '</a>';
                    
                    $('.last-commit-info').html(text);
                }
            });
            function setClock() {
                var time = new Date;
                time = time.toUTCString();
                $('.clock').text(time);
            }

            // source: https://stackoverflow.com/a/8212878/9990365
            function millisecondsToStr (milliseconds) {
                // TIP: to find current time in milliseconds, use:
                // var  current_time_milliseconds = new Date().getTime();

                function numberEnding (number) {
                    return (number > 1) ? 's' : '';
                }

                var temp = Math.floor(milliseconds / 1000);
                var years = Math.floor(temp / 31536000);
                if (years) {
                    return years + ' year' + numberEnding(years);
                }
                //TODO: Months! Maybe weeks? 
                var days = Math.floor((temp %= 31536000) / 86400);
                if (days) {
                    return days + ' day' + numberEnding(days);
                }
                var hours = Math.floor((temp %= 86400) / 3600);
                if (hours) {
                    return hours + ' hour' + numberEnding(hours);
                }
                var minutes = Math.floor((temp %= 3600) / 60);
                if (minutes) {
                    return minutes + ' minute' + numberEnding(minutes);
                }
                var seconds = temp % 60;
                if (seconds) {
                    return seconds + ' second' + numberEnding(seconds);
                }
                return 'less than a second'; //'just now' //or other string you like;
            }
